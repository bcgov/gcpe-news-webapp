@using Gov.News.Website.Models
@using Gov.News.Api.Models

@model ListViewModel

<div class="ministry-listing sector-listing@((ViewBag.Type != null && ViewBag.Type == "factsheets") ? " fact-sheets" : "")">
    <div class="home-features">
        <h4>@Model.Title</h4>
        @Html.Partial("ConnectSocialMedia")
        <!-- collapsible-regions are cloned here by _Layout-->
    </div>

    <div class="home-body">
        @if (ViewBag.Type != null && ViewBag.Type == "factsheets")
        {
            <h3>Factsheets</h3>
        }

        @if (Model.TopStory != null)
        {
            <div class="top-article">
                @Html.Partial("Article", Model.TopStory)
            </div>
        }

        @if (Model.FeatureStory != null)
        {
            <div class="feature-article">
                @Html.Partial("Article", Model.FeatureStory)
            </div>
        }

        <div class="other-articles">
            <div class="regular-articles">
                @foreach (var article in Model.LatestNews.Take(3))
                {
                    @Html.Partial("Article", article)
                }
                @foreach (var post in Model.LatestNews.Skip(3))
                {
                    @Html.Partial("Article", post, new ViewDataDictionary(new Microsoft.AspNetCore.Mvc.ModelBinding.EmptyModelMetadataProvider(), new Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary()) { { "Display", "false" } })
                }
            </div>

            <div class="news-control">
                @*TODO: Figure out what is wrong with the following line of code; it should not be hard-coded to factsheets.*@
                @if (ViewBag.Type != null && ViewBag.Type == "factsheets")
                {
                    @Html.ActionLink("Search News", "Search", "Default", new { content = "factsheets", sector = Model.Category.Key }, new { @class = "read-more" })
                    <a href="#" class="load-more link-button">Load More Factsheets</a>
                }
                else
                {
                    if (Model.Index is Category)
                    {
                        var category = (Category)Model.Index;

                        if (category.Kind == "ministries")
                        {
                            @Html.ActionLink("Search News", "Search", "Default", new { ministry = Model.Category.Key }, new { @class = "read-more" })
                        }
                        else if (category.Kind == "sectors")
                        {
                            @Html.ActionLink("Search News", "Search", "Default", new { sector = Model.Category.Key }, new { @class = "read-more" })
                        }
                    }
                    <a no href="#" rel="nofollow" class="load-more link-button">Load More News</a>
                }
                <div class="clear"> </div>
            </div>

            <div class="collapsible-regions">
                @Html.Partial("ResourceLinks")
                <vc:top-sectors />
                <div class="clear"></div>
            </div>
        </div>

        <div class="social-media-feed">
            @if (Model.FacebookPosts != null)
            {
                @Html.Partial("SocialMediaFacebookFeed", Model.FacebookPosts)
            }
            @if (Model.TwitterPosts != null)
            {
                @Html.Partial("SocialMediaTwitterFeed", Model.TwitterPosts)
            }
        </div>
    </div>
</div>